<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Debug</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 40px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      button:hover { background: #0056b3; }
      .result {
        margin: 20px 0;
        padding: 15px;
        border-radius: 4px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 11px;
        max-height: 500px;
        overflow-y: auto;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-family: Arial, sans-serif;
        font-size: 12px;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 6px;
        text-align: left;
      }
      th {
        background: #f2f2f2;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Simple User Debug</h1>
      <p>Check what users exist in the database without complex validation</p>

      <button onclick="checkUsers()">Check Database Users</button>
      <button onclick="testLogin()">Test Login with Console Logs</button>

      <div id="result"></div>
    </div>

    <script>
      async function checkUsers() {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<div class="result">Checking users...</div>';
        
        try {
          const response = await fetch('/api/simple-user-check');
          const result = await response.json();
          
          let html = '<div class="result ' + (response.ok ? 'success' : 'error') + '">';
          
          if (response.ok) {
            html += '<h3>‚úÖ Database Check Results</h3>';
            html += '<p><strong>Collections:</strong> ' + (result.collections ? result.collections.join(', ') : 'none') + '</p>';
            html += '<p><strong>Has Users Collection:</strong> ' + (result.hasUsersCollection ? 'Yes' : 'No') + '</p>';
            html += '<p><strong>Total Users:</strong> ' + result.userCount + '</p>';
            
            if (result.joelUser) {
              html += '<h4>üéØ Joel User Found:</h4>';
              html += '<p>Email: ' + result.joelUser.email + '</p>';
              html += '<p>Username: ' + result.joelUser.username + '</p>';
              html += '<p>Type: ' + result.joelUser.type + '</p>';
              html += '<p>Active: ' + result.joelUser.active + '</p>';
            } else {
              html += '<h4>‚ùå Joel User NOT FOUND</h4>';
              html += '<p>The user joelmooyoung@me.com does not exist in the database</p>';
            }
            
            if (result.sampleUsers && result.sampleUsers.length > 0) {
              html += '<h4>üìã All Users in Database:</h4>';
              html += '<table>';
              html += '<tr><th>Email</th><th>Username</th><th>Type</th><th>Active</th></tr>';
              
              result.sampleUsers.forEach(user => {
                html += '<tr>';
                html += '<td>' + (user.email || 'N/A') + '</td>';
                html += '<td>' + (user.username || 'N/A') + '</td>';
                html += '<td>' + (user.type || 'N/A') + '</td>';
                html += '<td>' + (user.active ? 'Yes' : 'No') + '</td>';
                html += '</tr>';
              });
              
              html += '</table>';
            }
          } else {
            html += '<h3>‚ùå Error</h3>';
            html += '<p>' + result.message + '</p>';
            html += '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
          }
          
          html += '</div>';
          resultDiv.innerHTML = html;
          
        } catch (error) {
          resultDiv.innerHTML = '<div class="result error">Network Error: ' + error.message + '</div>';
        }
      }

      async function testLogin() {
        console.log('üîç Testing login with joelmooyoung@me.com...');
        
        try {
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
              email: 'joelmooyoung@me.com', 
              password: '!IeatApples2' 
            }),
          });
          
          const result = await response.json();
          
          console.log('Login response status:', response.status);
          console.log('Login response:', result);
          
          document.getElementById('result').innerHTML = 
            '<div class="result ' + (response.ok ? 'success' : 'error') + '">' +
            '<h3>Login Test Result</h3>' +
            '<p>Status: ' + response.status + '</p>' +
            '<p>Success: ' + (result.success || false) + '</p>' +
            '<p>Message: ' + (result.message || 'No message') + '</p>' +
            '<p><strong>Check browser console for detailed logs</strong></p>' +
            '<pre>' + JSON.stringify(result, null, 2) + '</pre>' +
            '</div>';
          
        } catch (error) {
          console.error('Login test error:', error);
          document.getElementById('result').innerHTML = 
            '<div class="result error">Login test failed: ' + error.message + '</div>';
        }
      }

      // Auto-check users on page load
      window.onload = function() {
        checkUsers();
      };
    </script>
  </body>
</html>
