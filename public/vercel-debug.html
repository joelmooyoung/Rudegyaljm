<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vercel Debug Tool</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #0f172a;
        color: white;
        line-height: 1.6;
      }
      .test-section {
        background: rgba(59, 130, 246, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.5);
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      .success {
        background: rgba(34, 197, 94, 0.2);
        border-color: rgba(34, 197, 94, 0.5);
      }
      .error {
        background: rgba(239, 68, 68, 0.2);
        border-color: rgba(239, 68, 68, 0.5);
      }
      .warning {
        background: rgba(245, 158, 11, 0.2);
        border-color: rgba(245, 158, 11, 0.5);
      }
      button {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        margin: 10px;
        font-size: 14px;
      }
      button:hover {
        background: #2563eb;
      }
      pre {
        background: rgba(0, 0, 0, 0.5);
        padding: 15px;
        border-radius: 8px;
        overflow: auto;
        white-space: pre-wrap;
        max-height: 300px;
      }
      .step {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        border-left: 4px solid #60a5fa;
      }
    </style>
  </head>
  <body>
    <h1>üîß Vercel Deployment Debug Tool</h1>

    <div class="test-section" id="basic-test">
      <h3>üìä Basic Vercel Test</h3>
      <button onclick="testBasicVercel()">Test Vercel Homepage</button>
      <div id="basic-result">Click to test...</div>
    </div>

    <div class="test-section" id="api-test">
      <h3>üîó API Endpoints Test</h3>
      <button onclick="testAllAPIs()">Test All API Routes</button>
      <div id="api-result">Click to test...</div>
    </div>

    <div class="test-section" id="config-test">
      <h3>‚öôÔ∏è Configuration Analysis</h3>
      <button onclick="analyzeConfig()">Analyze Deployment</button>
      <div id="config-result">Click to analyze...</div>
    </div>

    <div class="test-section">
      <h3>üîç Troubleshooting Steps</h3>

      <div class="step">
        <h4>Step 1: Check Vercel Dashboard</h4>
        <p>
          1. Go to
          <a
            href="https://vercel.com/dashboard"
            target="_blank"
            style="color: #60a5fa"
            >Vercel Dashboard</a
          >
        </p>
        <p>2. Find your <strong>rudegyaljm</strong> project</p>
        <p>3. Check latest deployment status (should be green ‚úÖ)</p>
        <p>4. Click on deployment to see build logs</p>
      </div>

      <div class="step">
        <h4>Step 2: Verify Environment Variables</h4>
        <p>In Settings ‚Üí Environment Variables, ensure you have:</p>
        <pre>
MONGODB_URI = mongodb+srv://username:password@cluster.mongodb.net/rude-gyal-confessions?retryWrites=true&w=majority
NODE_ENV = production</pre
        >
        <p>
          <strong>Important:</strong> Variables must be set for "Production"
          environment
        </p>
      </div>

      <div class="step">
        <h4>Step 3: Check Git Push</h4>
        <p>Ensure your latest changes were pushed to git:</p>
        <ul>
          <li>Updated vercel.json</li>
          <li>API files in /api/ directory</li>
          <li>Environment variables set</li>
        </ul>
      </div>

      <div class="step">
        <h4>Step 4: Force Redeploy</h4>
        <p>1. In Vercel dashboard ‚Üí Deployments</p>
        <p>2. Click "..." on latest deployment</p>
        <p>3. Click "Redeploy"</p>
        <p>4. Wait for completion</p>
      </div>
    </div>

    <div class="test-section">
      <h3>üÜò If Nothing Works</h3>
      <p>Try these URLs to isolate the issue:</p>
      <ul>
        <li>
          <a
            href="https://rudegyaljm.vercel.app/"
            target="_blank"
            style="color: #60a5fa"
            >Main App</a
          >
          - Should load (not 404)
        </li>
        <li>
          <a
            href="https://rudegyaljm.vercel.app/api/ping"
            target="_blank"
            style="color: #60a5fa"
            >API Ping</a
          >
          - Should return JSON
        </li>
        <li>
          <a
            href="https://rudegyaljm.vercel.app/vercel-debug.html"
            target="_blank"
            style="color: #60a5fa"
            >This Debug Tool</a
          >
          - Should load this page
        </li>
      </ul>
    </div>

    <script>
      async function testBasicVercel() {
        const result = document.getElementById("basic-result");
        const section = document.getElementById("basic-test");

        result.innerHTML = "Testing Vercel homepage...";

        try {
          const response = await fetch("https://rudegyaljm.vercel.app/");
          const text = await response.text();

          if (response.ok) {
            const hasReactApp = text.includes('id="root"');
            const hasAssets = text.includes("/assets/");

            result.innerHTML = `
              <h4>‚úÖ Vercel Homepage Working</h4>
              <p>Status: ${response.status}</p>
              <p>Has React app: ${hasReactApp ? "‚úÖ" : "‚ùå"}</p>
              <p>Has assets: ${hasAssets ? "‚úÖ" : "‚ùå"}</p>
              <details>
                <summary>Response preview</summary>
                <pre>${text.substring(0, 500)}...</pre>
              </details>
            `;
            section.className = "test-section success";
          } else {
            result.innerHTML = `‚ùå Homepage failed: ${response.status}`;
            section.className = "test-section error";
          }
        } catch (error) {
          result.innerHTML = `‚ùå Homepage error: ${error.message}`;
          section.className = "test-section error";
        }
      }

      async function testAllAPIs() {
        const result = document.getElementById("api-result");
        const section = document.getElementById("api-test");

        result.innerHTML = "Testing API endpoints...";

        const endpoints = ["/api/ping", "/api/stories", "/api/seed-database"];

        let results = "<h4>API Test Results:</h4>";
        let allWorking = true;

        for (const endpoint of endpoints) {
          try {
            const response = await fetch(
              `https://rudegyaljm.vercel.app${endpoint}`,
            );
            const status = response.status;

            if (status === 200) {
              results += `<p>‚úÖ ${endpoint}: Working (${status})</p>`;
            } else if (status === 404) {
              results += `<p>‚ùå ${endpoint}: Not Found (404)</p>`;
              allWorking = false;
            } else if (status === 405) {
              results += `<p>‚ö†Ô∏è ${endpoint}: Method not allowed (405) - Expected for some endpoints</p>`;
            } else {
              results += `<p>‚ö†Ô∏è ${endpoint}: Status ${status}</p>`;
            }
          } catch (error) {
            results += `<p>‚ùå ${endpoint}: Error - ${error.message}</p>`;
            allWorking = false;
          }
        }

        result.innerHTML = results;
        section.className = allWorking
          ? "test-section success"
          : "test-section error";
      }

      async function analyzeConfig() {
        const result = document.getElementById("config-result");
        const section = document.getElementById("config-test");

        result.innerHTML = `
          <h4>üìã Configuration Checklist</h4>
          <p>‚úÖ vercel.json updated</p>
          <p>‚úÖ API files exist in /api/ directory</p>
          <p>‚ùì Environment variables set (check Vercel dashboard)</p>
          <p>‚ùì Latest deployment successful (check Vercel dashboard)</p>
          
          <h4>üîç Common Issues:</h4>
          <ul>
            <li><strong>404 on APIs:</strong> Environment variables missing</li>
            <li><strong>500 errors:</strong> MongoDB connection failed</li>
            <li><strong>Blank page:</strong> React app build issue</li>
            <li><strong>Old content:</strong> Need to redeploy</li>
          </ul>
          
          <h4>üéØ Most Likely Fix:</h4>
          <p>1. Verify MONGODB_URI is set correctly in Vercel</p>
          <p>2. Force redeploy from Vercel dashboard</p>
          <p>3. Wait 2-3 minutes for propagation</p>
        `;

        section.className = "test-section warning";
      }

      // Auto-run basic test on load
      window.onload = () => {
        setTimeout(testBasicVercel, 1000);
      };
    </script>
  </body>
</html>
